<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suno Playground</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        :root {
            --bg-page: #0E1117; --bg-card: #161B22; --bg-input: #0E1117;
            --border: #30363D; --text-primary: #E6EDF3; --text-secondary: #8B949E;
            --accent-blue: #3882F6; --accent-blue-hover: #58A6FF; --accent-blue-active: #2188ff;
            --accent-green: #238636; --accent-red: #da3633;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background-color: var(--bg-page); color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            padding: 30px; display: flex; justify-content: center;
        }
        .page-container { width: 100%; max-width: 1200px; display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
        .header { grid-column: 1 / -1; display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .header h1 { font-size: 24px; font-weight: 600; }
        .header p { font-size: 14px; color: var(--text-secondary); }
        .card { background-color: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 24px; display: flex; flex-direction: column; }
        .main-card { grid-column: 1 / 2; }
        .library-card { grid-column: 2 / 3; position: relative; padding-bottom: 96px; /* Space for player */ }
        .tabs { display: flex; margin-bottom: 24px; border-bottom: 1px solid var(--border); flex-wrap: wrap; }
        .tab-button {
            position: relative; background: none; border: none; color: var(--text-secondary); padding: 0 4px 12px 4px; margin: 0 12px;
            cursor: pointer; font-size: 14px; font-weight: 500; border-bottom: 2px solid transparent; transition: color 0.2s, border-color 0.2s;
        }
        .tab-button:first-child { margin-left: 0; }
        .tab-button:hover { color: var(--text-primary); }
        .tab-button.active { color: var(--text-primary); border-bottom-color: var(--accent-blue); font-weight: 600; }
        .notification-dot {
            display: none; position: absolute; top: -2px; right: -8px; width: 8px; height: 8px;
            background-color: var(--accent-red); border-radius: 50%; border: 2px solid var(--bg-card);
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease-out forwards; }
        .tab-content.exiting { animation: fadeOut 0.3s ease-in forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(5px); } }
        .form-grid { display: flex; flex-direction: column; gap: 20px; }
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        .form-group input, .form-group textarea, .form-group select {
            background-color: var(--bg-input); border: 1px solid var(--border); border-radius: 6px;
            color: var(--text-primary); padding: 10px 12px; font-size: 14px; width: 100%; transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-group input::placeholder, .form-group textarea::placeholder { color: var(--text-secondary); }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            border-color: var(--accent-blue); outline: none; box-shadow: 0 0 0 3px rgba(56, 130, 246, 0.3);
        }
        .form-group .input-error { border-color: var(--accent-red); box-shadow: 0 0 0 3px rgba(218, 54, 51, 0.3); }
        .form-group textarea { resize: vertical; min-height: 120px; }
        .form-row { display: flex; justify-content: space-between; align-items: center; }
        .char-counter { text-align: right; font-size: 12px; color: var(--text-secondary); margin-top: -4px; }
        .submit-button {
            background-color: var(--accent-blue); border: 1px solid var(--accent-blue); border-radius: 6px; padding: 10px;
            font-weight: 600; color: white; font-size: 14px; width: 100%; cursor: pointer;
            transition: background-color 0.2s, opacity 0.2s, transform 0.1s;
        }
        .submit-button:hover { background-color: var(--accent-blue-hover); }
        .submit-button:active { transform: scale(0.98) translateY(1px); }
        .toggle-switch { display: flex; align-items: center; gap: 12px; color: var(--text-primary); font-size: 14px; font-weight: 500; }
        .toggle-switch input { display: none; }
        .toggle-switch .slider {
            position: relative; width: 38px; height: 22px; background-color: #30363D;
            border-radius: 11px; cursor: pointer; transition: background-color 0.2s;
        }
        .toggle-switch .slider::before {
            content: ''; position: absolute; left: 2px; top: 2px; width: 18px; height: 18px;
            background-color: white; border-radius: 50%; transition: transform 0.2s;
        }
        .toggle-switch input:checked + .slider { background-color: var(--accent-blue); }
        .toggle-switch input:checked + .slider::before { transform: translateX(16px); }
        .card h4 { font-size: 16px; font-weight: 600; margin-bottom: 16px; }
        #logs-content pre {
            background-color: var(--bg-input); padding: 16px; border: 1px solid var(--border);
            border-radius: 6px; white-space: pre-wrap; word-wrap: break-word; font-size: 13px; max-height: 80vh; overflow-y: auto; line-height: 1.6;
        }
        .credits-display {
            background-color: var(--bg-card); border: 1px solid var(--border); color: var(--text-secondary); padding: 8px 12px; border-radius: 8px;
            font-size: 14px; font-weight: 500; display: inline-flex; align-items: center; gap: 6px;
        }
        .credits-display .credits-value { color: var(--text-primary); font-weight: 700; margin-right: 4px; }
        .credits-display .credits-icon svg { display: block; width: 16px; height: 16px; }
        .custom-select-wrapper { position: relative; width: 100px; user-select: none; }
        .select-button {
            background-color: var(--bg-input); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary);
            padding: 8px 12px; font-size: 14px; font-weight: 500; cursor: pointer; display: flex; justify-content: space-between; align-items: center;
        }
        .select-button::after {
            content: ''; border: solid var(--text-secondary); border-width: 0 2px 2px 0; display: inline-block; padding: 3px; transform: rotate(45deg); transition: transform 0.2s;
        }
        .select-dropdown.open ~ .select-button::after { transform: rotate(-135deg); }
        .select-dropdown {
            position: absolute; top: calc(100% + 4px); left: 0; right: 0; background-color: #21262d;
            border: 1px solid var(--border); border-radius: 6px; padding: 4px; z-index: 10; display: none;
        }
        .select-dropdown.open { display: block; }
        .select-option { padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 14px; }
        .select-option:hover { background-color: #30363d; }
        .select-option.selected { background-color: var(--accent-blue-active); font-weight: 600; }
        .status-message {
            background-color: var(--bg-input); border: 1px solid var(--border); padding: 12px;
            border-radius: 6px; font-weight: 500; color: var(--text-secondary); margin-bottom: 16px;
        }
        .status-message.success { border-left: 4px solid var(--accent-green); color: var(--text-primary); }
        .status-message.error { border-left: 4px solid var(--accent-red); color: var(--text-primary); }
        hr.divider { border: none; border-top: 1px solid var(--border); margin: 20px 0; }
        #song-list-container { display: flex; flex-direction: column; gap: 16px; overflow-y: auto; padding-right: 10px; flex-grow: 1; }
        .song-card { display: flex; align-items: flex-start; gap: 16px; }
        .song-card.placeholder { opacity: 0.6; align-items: center; }
        .song-cover {
            width: 80px; height: 80px; border-radius: 8px; cursor: pointer;
            position: relative; overflow: hidden; flex-shrink: 0;
            background-color: var(--bg-input);
        }
        .song-cover img { width: 100%; height: 100%; object-fit: cover; }
        .song-cover .play-icon {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 32px; height: 32px; background-color: rgba(0,0,0,0.5); border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            color: white; opacity: 0; transition: opacity 0.2s;
        }
        .song-cover:hover .play-icon, .song-cover.playing .play-icon, .song-cover.paused .play-icon { opacity: 1; }
        .song-duration {
            position: absolute; bottom: 4px; right: 4px; background-color: rgba(0, 0, 0, 0.7);
            color: white; font-size: 11px; font-weight: 600; padding: 2px 5px; border-radius: 4px;
        }
        .song-info { display: flex; flex-direction: column; gap: 4px; flex-grow: 1; min-width: 0; }
        .song-title { font-size: 16px; font-weight: 600; color: var(--text-primary); cursor: pointer; }
        .song-model-tag {
            background-color: var(--border); color: var(--text-secondary); font-size: 11px;
            font-weight: 600; padding: 2px 6px; border-radius: 4px; display: inline-block; margin-left: 8px; vertical-align: middle;
        }
        .song-style { font-size: 14px; color: var(--text-secondary); word-break: break-word; }
        .song-style-content.collapsed {
            overflow: hidden; text-overflow: ellipsis;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
        }
        .toggle-description-btn {
            background: none; border: none; color: var(--accent-blue-hover); cursor: pointer;
            font-size: 12px; padding: 4px 0; font-weight: 600;
        }
        .song-actions { position: relative; }
        .menu-trigger { background:none; border:none; color: var(--text-secondary); cursor:pointer; padding: 5px; font-size: 16px; }
        .menu-trigger:hover { color: var(--text-primary); }
        .song-menu {
            display: none; position: absolute; right: 0; top: 25px;
            background-color: #21262d; border: 1px solid var(--border);
            border-radius: 6px; list-style: none; padding: 5px;
            width: 180px; z-index: 10;
        }
        .song-menu.active { display: block; }
        .menu-item {
            display: flex; align-items: center; gap: 10px;
            padding: 8px 10px; border-radius: 4px; cursor: pointer; font-size: 14px;
        }
        .menu-item:hover { background-color: var(--border); }
        .menu-item i { width: 16px; text-align: center; }
        .menu-item.delete { color: var(--accent-red); }
        #empty-list-message { color: var(--text-secondary); text-align: center; padding: 20px; }
        .progress-bar-container { width: 100%; background-color: var(--border); border-radius: 4px; height: 6px; overflow: hidden; margin-top: 8px; }
        .progress-bar-inner { width: 0%; height: 100%; background-color: var(--accent-blue); transition: width 0.5s ease; }
        
        #global-player {
            position: fixed; bottom: 0; left: 0; right: 0;
            background-color: #1c2128; border-top: 1px solid var(--border);
            padding: 10px 30px; display: none; align-items: center;
            gap: 20px; z-index: 100;
        }
        #player-song-info { display: flex; align-items: center; gap: 15px; min-width: 200px; }
        #player-cover { width: 56px; height: 56px; border-radius: 4px; }
        #player-title-artist { font-size: 14px; color: var(--text-primary); }
        #player-title { font-weight: 600; }
        #player-main { flex-grow: 1; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        #player-controls { display: flex; align-items: center; gap: 20px; }
        .player-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 18px; transition: color 0.2s; }
        .player-btn:hover { color: var(--text-primary); }
        .player-btn#play-pause-btn { font-size: 28px; color: var(--text-primary); }
        .player-btn.active { color: var(--accent-blue); }
        #player-timeline { display: flex; align-items: center; gap: 10px; width: 100%; max-width: 600px; }
        .time-display { font-size: 12px; color: var(--text-secondary); width: 40px; text-align: center; }
        #seek-bar {
            flex-grow: 1; -webkit-appearance: none; appearance: none;
            width: 100%; height: 5px; background: var(--border);
            outline: none; border-radius: 3px; cursor: pointer;
        }
        #seek-bar::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 14px; height: 14px; background: var(--text-primary);
            border-radius: 50%; cursor: pointer;
        }
        #player-extra-controls { min-width: 200px; display: flex; justify-content: flex-end; }

        #lyrics-modal-overlay, #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(14, 17, 23, 0.85); backdrop-filter: blur(5px);
            display: flex; justify-content: center; align-items: center;
            z-index: 2000; animation: fadeIn 0.3s;
        }
        #lyrics-modal-overlay { display: none; }
        #lyrics-modal-box {
            background-color: var(--bg-card); padding: 24px;
            border-radius: 8px; border: 1px solid var(--border);
            width: 90%; max-width: 600px; max-height: 80vh;
            display: flex; flex-direction: column;
        }
        #lyrics-modal-content { overflow-y: auto; line-height: 1.6; white-space: pre-wrap; padding-right: 10px; }
        #lyrics-modal-close {
            align-self: flex-end; background: none; border: none;
            color: var(--text-secondary); font-size: 24px; cursor: pointer;
            line-height: 1; margin: -12px -12px 12px 0;
        }
        #login-box {
            background-color: var(--bg-card); padding: 32px;
            border-radius: 8px; border: 1px solid var(--border);
            text-align: center; width: 100%; max-width: 340px;
        }
        #login-box h3 { margin-bottom: 16px; font-weight: 600; }
        #access-key-input {
            width: 100%; padding: 10px 12px; background-color: var(--bg-input);
            border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary);
            font-size: 16px; text-align: center;
        }
        #access-key-button {
            width: 100%; margin-top: 16px; background-color: var(--accent-blue);
            border: none; padding: 10px; border-radius: 6px;
            color: white; font-weight: 600; cursor: pointer;
            transition: background-color 0.2s;
        }
        #access-key-button:hover { background-color: var(--accent-blue-hover); }
        #login-error-message { color: var(--accent-red); margin-top: 12px; height: 16px; font-size: 14px; }
        @media (max-width: 900px) { .page-container { grid-template-columns: 1fr; } .main-card, .library-card { grid-column: auto; } }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div id="login-box">
            <h3>–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞</h3>
            <input type="password" id="access-key-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <button id="access-key-button">–í–æ–π—Ç–∏</button>
            <p id="login-error-message"></p>
        </div>
    </div>
    
    <div id="app-container" style="display: none;">
        <div class="page-container">
            <header class="header">
                <div><h1>Suno Playground</h1><p>–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ API —Å –ø–æ–º–æ—â—å—é —Ñ–æ—Ä–º –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –æ—Ç–≤–µ—Ç—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.</p></div>
                <div id="credits-container" class="credits-display" style="display: none;">
                    <span class="credits-value" id="credits-value">...</span>
                    <span class="credits-icon"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path fill="#f7b731" d="M9.91 15.42c-1.2.7-2.62.7-3.82 0L2.14 13.1c-1.2-.7-1.95-2-1.95-3.37V6.27c0-1.37.75-2.67 1.95-3.37L6.09 0.58c1.2-.7 2.62-.7 3.82 0l3.95 2.32c1.2.7 1.95 2 1.95 3.37v3.46c0 1.37-.75 2.67-1.95 3.37l-3.95 2.32z"></path><path fill="#ffffff" d="M8 10.87a.6.6 0 01-.35-.11L5.5 9.53a.6.6 0 01-.22-.8l.74-2.16-1.63-1.63a.6.6 0 01.16-.94l2.16-.73L7.9 1.1a.6.6 0 011.08.38l.73 2.16 2.16.73a.6.6 0 01.16.94L10.4 7.57l.74 2.16a.6.6 0 01-.22.8l-2.15 1.23a.6.6 0 01-.35.11z"></path></svg></span>
                </div>
            </header>

            <div class="card main-card">
                <div class="tabs">
                    <button class="tab-button active" onclick="openTab(event, 'generate')">–°–æ–∑–¥–∞—Ç—å</button>
                    <button class="tab-button" onclick="openTab(event, 'extend')">–ü—Ä–æ–¥–ª–∏—Ç—å</button>
                    <button class="tab-button" onclick="openTab(event, 'upload')">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                    <button class="tab-button" id="logs-tab-button" onclick="openTab(event, 'logs')">–õ–æ–≥–∏<span id="logs-notification-dot" class="notification-dot"></span></button>
                </div>

                <div id="generate" class="tab-content active">
                    <form id="generate-music-form" class="form-grid">
                        <div class="form-row"><label class="toggle-switch"><input type="checkbox" id="g-customMode" checked><span class="slider"></span><span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º</span></label><div class="custom-select-wrapper"><input type="hidden" id="g-model-value" value="V4_5PLUS"><div class="select-button" id="select-model-button">V4.5+</div><div class="select-dropdown" id="select-model-dropdown"><div class="select-option selected" data-value="V4_5PLUS">V4.5+</div><div class="select-option" data-value="V4_5">V4.5</div><div class="select-option" data-value="V4">V4</div><div class="select-option" data-value="V3_5">V3.5</div></div></div></div>
                        <div id="simple-mode-fields" class="form-grid" style="display: none;"><div class="form-group" id="g-song-description-group"><label for="g-song-description">–û–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Å–Ω–∏</label><textarea id="g-song-description" placeholder="–û–ø–∏—à–∏—Ç–µ —Å—Ç–∏–ª—å –º—É–∑—ã–∫–∏, —Ç–µ–º—É –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ..."></textarea></div></div>
                        <div id="custom-mode-fields" class="form-grid">
                            <div class="form-group"><label for="g-title">–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="g-title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ"></div>
                            <div class="form-group"><label for="g-style">–°—Ç–∏–ª—å –º—É–∑—ã–∫–∏</label><textarea id="g-style" oninput="updateCharCounter(this, 'g-style-counter')"></textarea><div id="g-style-counter" class="char-counter"></div></div>
                            <div class="form-group" id="g-prompt-group"><label for="g-prompt">–¢–µ–∫—Å—Ç –ø–µ—Å–Ω–∏</label><textarea id="g-prompt" oninput="updateCharCounter(this, 'g-prompt-counter')"></textarea><div id="g-prompt-counter" class="char-counter"></div></div>
                            <hr class="divider">
                            <label class="toggle-switch"><input type="checkbox" id="g-instrumental"><span class="slider"></span><span>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª</span></label>
                            <div class="form-group"><label for="g-negativeTags">–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ–≥–∏</label><input type="text" id="g-negativeTags" placeholder="Heavy Metal, Upbeat Drums"></div>
                            <div class="form-group"><label for="g-vocalGender">–ü–æ–ª –≤–æ–∫–∞–ª–∞</label><select id="g-vocalGender"><option value="">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option><option value="m">–ú—É–∂—Å–∫–æ–π</option><option value="f">–ñ–µ–Ω—Å–∫–∏–π</option></select></div>
                        </div>
                        <button type="submit" class="submit-button" id="g-submit-button">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º—É–∑—ã–∫—É</button>
                    </form>
                </div>
                
                <div id="extend" class="tab-content"><form id="extend-music-form" class="form-grid"><div class="form-group"><label for="e-audioId">Audio ID</label><input type="text" id="e-audioId" placeholder="ID —Ç—Ä–µ–∫–∞ –¥–ª—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è" required></div><div class="form-group"><label for="e-continueAt">–ü—Ä–æ–¥–ª–∏—Ç—å —Å (—Å–µ–∫—É–Ω–¥—ã)</label><input type="number" id="e-continueAt" value="60"></div><button type="submit" class="submit-button">–ü—Ä–æ–¥–ª–∏—Ç—å —Ç—Ä–µ–∫</button></form></div>
                <div id="upload" class="tab-content"><div class="form-grid"><form id="upload-cover-form" class="form-grid"><div class="form-group"><label for="uc-uploadUrl">URL –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∞—É–¥–∏–æ</label><input type="text" id="uc-uploadUrl" placeholder="https://storage.example.com/audio.mp3" required></div><div class="form-group"><label for="uc-prompt">Prompt (–æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–≤–µ—Ä–∞)</label><textarea id="uc-prompt" placeholder="A calm and relaxing piano track..."></textarea></div><button type="submit" class="submit-button">–°–æ–∑–¥–∞—Ç—å –∫–∞–≤–µ—Ä</button></form><hr class="divider"><form id="upload-extend-form" class="form-grid"><div class="form-group"><label for="ue-uploadUrl">URL –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∞—É–¥–∏–æ</label><input type="text" id="ue-uploadUrl" placeholder="https://storage.example.com/audio.mp3" required></div><div class="form-group"><label for="ue-continueAt">–ü—Ä–æ–¥–ª–∏—Ç—å —Å (—Å–µ–∫—É–Ω–¥—ã)</label><input type="number" id="ue-continueAt" value="60"></div><button type="submit" class="submit-button">–ü—Ä–æ–¥–ª–∏—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ</button></form></div></div>
                
                <div id="logs" class="tab-content">
                    <div id="logs-content">
                        <h4>–°—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ü–∏–∏</h4>
                        <div id="status-container"><p class="status-message">–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á–∏...</p></div>
                        <h4>–û—Ç–≤–µ—Ç API</h4>
                        <pre id="response-output">–û–∂–∏–¥–∞–Ω–∏–µ –≤—ã–∑–æ–≤–∞ API...</pre>
                    </div>
                </div>
            </div>

            <div class="card library-card">
                <h4>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</h4>
                <hr class="divider">
                <div id="song-list-container">
                    <p id="empty-list-message">–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–∞—à–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Å–Ω–∏.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="global-player">
        <div id="player-song-info">
            <img id="player-cover" src="" alt="cover">
            <div>
                <div id="player-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–∫</div>
            </div>
        </div>
        <div id="player-main">
            <div id="player-controls">
                <button class="player-btn" id="shuffle-btn"><i class="fas fa-random"></i></button>
                <button class="player-btn" id="prev-btn"><i class="fas fa-step-backward"></i></button>
                <button class="player-btn" id="play-pause-btn"><i class="fas fa-play"></i></button>
                <button class="player-btn" id="next-btn"><i class="fas fa-step-forward"></i></button>
                <button class="player-btn" id="repeat-btn"><i class="fas fa-repeat"></i></button>
            </div>
            <div id="player-timeline">
                <span id="current-time" class="time-display">0:00</span>
                <input type="range" id="seek-bar" value="0" step="0.1">
                <span id="total-duration" class="time-display">0:00</span>
            </div>
        </div>
        <div id="player-extra-controls">
            <!-- Extra controls can go here in the future -->
        </div>
    </div>

    <div id="lyrics-modal-overlay">
        <div id="lyrics-modal-box">
            <button id="lyrics-modal-close">&times;</button>
            <div id="lyrics-modal-content"></div>
        </div>
    </div>

<script>
    // --- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
    const SECRET_KEY = 'messisipi'; // <<< !!! –ò–ó–ú–ï–ù–ò–¢–ï –≠–¢–û–¢ –ö–õ–Æ–ß –ù–ê –°–í–û–ô !!!
    let pollingInterval; let currentTabName = 'generate';
    const modelMap = { "V4_5PLUS": "V4.5+", "V4_5": "V4.5", "V4": "V4", "V3_5": "V3.5" };

    let playlist = [];
    let currentTrackIndex = -1;
    let isShuffled = false;
    let isRepeatOne = false;

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –≠–õ–ï–ú–ï–ù–¢–û–í ---
    // Will be populated by the main initializeApp function
    let customModeToggle, simpleModeFields, customModeFields, modelValueInput, selectButton, selectDropdown, styleTextarea, promptTextarea, instrumentalToggle, promptGroup, descriptionGroup, statusContainer, songListContainer, emptyListMessage, logsNotificationDot, globalPlayer, lyricsModal, titleInput, styleInput, promptInput, descriptionInput;

    function formatTime(seconds) { if(isNaN(seconds)||seconds===null||!isFinite(seconds))return'--:--';const m=Math.floor(seconds/60),s=Math.floor(seconds%60);return`${m}:${s<10?"0":""}${s}`;}

    // --- –õ–û–ì–ò–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ---
    function handleLogin() {
        const loginElements = { overlay: document.getElementById('login-overlay'), container: document.getElementById('app-container'), input: document.getElementById('access-key-input'), button: document.getElementById('access-key-button'), error: document.getElementById('login-error-message') };
        if (loginElements.input.value === SECRET_KEY) {
            loginElements.overlay.style.display = 'none';
            loginElements.container.style.display = 'block';
            sessionStorage.setItem('is-authenticated', 'true');
            initializeApp();
        } else {
            loginElements.error.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á';
            loginElements.input.value = '';
        }
    }
    document.getElementById('access-key-button').addEventListener('click', handleLogin);
    document.getElementById('access-key-input').addEventListener('keydown', (e) => { if (e.key === 'Enter') handleLogin(); });

    // --- –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò ---
    function initializeApp() {
        // Query all elements now that the app container is visible
        customModeToggle=document.getElementById("g-customMode"); simpleModeFields=document.getElementById("simple-mode-fields"); customModeFields=document.getElementById("custom-mode-fields"); modelValueInput=document.getElementById("g-model-value"); selectButton=document.getElementById("select-model-button"); selectDropdown=document.getElementById("select-model-dropdown"); styleTextarea=document.getElementById("g-style"); promptTextarea=document.getElementById("g-prompt"); instrumentalToggle=document.getElementById("g-instrumental"); promptGroup=document.getElementById("g-prompt-group"); descriptionGroup=document.getElementById("g-song-description-group"); statusContainer=document.getElementById("status-container"); songListContainer = document.getElementById('song-list-container'); emptyListMessage = document.getElementById('empty-list-message'); logsNotificationDot = document.getElementById('logs-notification-dot');
        globalPlayer={container:document.getElementById("global-player"),audio:document.createElement('audio'),cover:document.getElementById("player-cover"),title:document.getElementById("player-title"),seekBar:document.getElementById("seek-bar"),playPauseBtn:document.getElementById("play-pause-btn"),currentTime:document.getElementById("current-time"),totalDuration:document.getElementById("total-duration"),prevBtn: document.getElementById('prev-btn'), nextBtn: document.getElementById('next-btn'), shuffleBtn: document.getElementById('shuffle-btn'), repeatBtn: document.getElementById('repeat-btn'),currentSongId:null};
        lyricsModal = { overlay: document.getElementById('lyrics-modal-overlay'), content: document.getElementById('lyrics-modal-content'), closeBtn: document.getElementById('lyrics-modal-close') };
        titleInput = document.getElementById('g-title'); styleInput = document.getElementById('g-style'); promptInput = document.getElementById('g-prompt'); descriptionInput = document.getElementById('g-song-description');

        // --- –õ–û–ì–ò–ö–ê –ü–õ–ï–ï–†–ê ---
        function playSongByIndex(index) {
            currentTrackIndex = index;
            const songData = playlist[currentTrackIndex].songData;
            globalPlayer.currentSongId = songData.id;
            globalPlayer.cover.src = songData.imageUrl;
            globalPlayer.title.textContent = songData.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
            globalPlayer.audio.src = songData.streamAudioUrl;
            globalPlayer.audio.play();
            globalPlayer.container.style.display = 'flex';
            updateAllPlayIcons();
        }

        function playNext() {
            if (playlist.length === 0) return;
            let nextIndex;
            if (isShuffled) {
                nextIndex = Math.floor(Math.random() * playlist.length);
            } else {
                nextIndex = (currentTrackIndex + 1) % playlist.length;
            }
            playSongByIndex(nextIndex);
        }

        function playPrevious() {
            if (playlist.length === 0) return;
            let prevIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
            playSongByIndex(prevIndex);
        }

        async function refreshSongUrl(songId) {
            try {
                const response = await fetch('/api/refresh-url', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ id: songId }) });
                if (!response.ok) throw new Error('Failed to refresh URL');
                const data = await response.json();
                const songIndex = playlist.findIndex(p => p.songData.id === songId);
                if (songIndex > -1) {
                    playlist[songIndex].songData.streamAudioUrl = data.newUrl;
                    if(globalPlayer.currentSongId === songId) { globalPlayer.audio.src = data.newUrl; globalPlayer.audio.play(); }
                }
            } catch (error) { console.error("Couldn't refresh URL:", error); }
        }
        
        globalPlayer.audio.onerror = () => { if(globalPlayer.currentSongId) { refreshSongUrl(globalPlayer.currentSongId); } };

        function updateAllPlayIcons() {
            document.querySelectorAll('.song-cover').forEach(el => {
                const id = el.id.replace('cover-', '');
                el.classList.remove('playing', 'paused');
                if (id === globalPlayer.currentSongId) { el.classList.add(globalPlayer.audio.paused ? 'paused' : 'playing'); }
            });
        }
        
        globalPlayer.playPauseBtn.onclick=()=>{if(globalPlayer.audio.src){if(globalPlayer.audio.paused)globalPlayer.audio.play();else globalPlayer.audio.pause();}};
        globalPlayer.audio.onplay=()=>{globalPlayer.playPauseBtn.innerHTML=`<i class="fas fa-pause"></i>`; updateAllPlayIcons();};
        globalPlayer.audio.onpause=()=>{globalPlayer.playPauseBtn.innerHTML=`<i class="fas fa-play"></i>`; updateAllPlayIcons();};
        globalPlayer.audio.onloadedmetadata=()=>{globalPlayer.seekBar.max=globalPlayer.audio.duration;globalPlayer.totalDuration.textContent=formatTime(globalPlayer.audio.duration);};
        globalPlayer.audio.ontimeupdate=()=>{globalPlayer.seekBar.value=globalPlayer.audio.currentTime;globalPlayer.currentTime.textContent=formatTime(globalPlayer.audio.currentTime);};
        globalPlayer.seekBar.oninput=()=>(globalPlayer.audio.currentTime=globalPlayer.seekBar.value);
        globalPlayer.audio.onended = () => { if(isRepeatOne) { globalPlayer.audio.currentTime = 0; globalPlayer.audio.play(); } else { playNext(); }};
        globalPlayer.nextBtn.onclick = playNext;
        globalPlayer.prevBtn.onclick = playPrevious;
        globalPlayer.shuffleBtn.onclick = () => { isShuffled = !isShuffled; globalPlayer.shuffleBtn.classList.toggle('active', isShuffled); };
        globalPlayer.repeatBtn.onclick = () => { isRepeatOne = !isRepeatOne; globalPlayer.repeatBtn.classList.toggle('active', isRepeatOne); };


        // --- –õ–û–ì–ò–ö–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê ---
        async function downloadSong(event, url, filename) {
            event.preventDefault(); const button = event.currentTarget; const originalHTML = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –°–∫–∞—á–∏–≤–∞–Ω–∏–µ...'; button.style.cursor = 'wait';
            try {
                const response = await fetch(url); const blob = await response.blob(); const blobUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a'); a.style.display = 'none'; a.href = blobUrl; a.download = filename;
                document.body.appendChild(a); a.click(); window.URL.revokeObjectURL(blobUrl); a.remove();
            } catch (error) { console.error('Download failed:', error); button.innerHTML = '<i class="fas fa-exclamation-circle"></i> –û—à–∏–±–∫–∞';
            } finally { setTimeout(() => { button.innerHTML = originalHTML; button.style.cursor = 'pointer'; }, 1500); }
        }

        function showLyrics(promptText) {
            lyricsModal.content.textContent = promptText;
            lyricsModal.overlay.style.display = 'flex';
        }
        lyricsModal.closeBtn.onclick = () => lyricsModal.overlay.style.display = 'none';
        lyricsModal.overlay.onclick = (e) => { if (e.target === lyricsModal.overlay) lyricsModal.overlay.style.display = 'none'; };

        function copyToClipboard(text, element) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = element.textContent;
                element.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!'; element.style.color = 'var(--accent-green)';
                setTimeout(() => { element.textContent = originalText; element.style.color = ''; }, 1500);
            });
        }
        
        async function deleteSong(songId, cardElement) {
            try {
                const response = await fetch(`/api/songs/${songId}`, { method: 'DELETE' });
                if (!response.ok) throw new Error('Failed to delete');
                cardElement.style.transition = 'opacity 0.3s, transform 0.3s';
                cardElement.style.opacity = '0'; cardElement.style.transform = 'translateX(-20px)';
                setTimeout(() => { 
                    cardElement.remove();
                    playlist = playlist.filter(p => p.songData.id !== songId);
                }, 300);
            } catch (e) { console.error("Could not delete song", e); }
        }
        
        function addSongToList(songInfo) {
            if (emptyListMessage) emptyListMessage.style.display = 'none';
            const { songData, requestParams } = songInfo;
            const card = document.createElement('div'); card.className = 'song-card'; card.id = `song-${songData.id}`;
            let friendlyModelName = 'v4';
            try { const params = JSON.parse(requestParams); friendlyModelName = modelMap[params.model] || params.model; } catch(e) {}
            const downloadUrl = songData.audioUrl || songData.streamAudioUrl; const filename = `${songData.title || 'track'}.mp3`;
            card.innerHTML = `<div class="song-cover" id="cover-${songData.id}"><img src="${songData.imageUrl}" alt="–û–±–ª–æ–∂–∫–∞ —Ç—Ä–µ–∫–∞"><div class="song-duration">${formatTime(songData.duration)}</div><div class="play-icon"><i class="fas fa-play"></i></div></div><div class="song-info"><div><span class="song-title">${songData.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</span><span class="song-model-tag">${friendlyModelName}</span></div><div class="song-style"><div class="song-style-content">${songData.tags || '(no styles)'}</div></div></div><div class="song-actions"><button class="menu-trigger"><i class="fas fa-ellipsis-v"></i></button><ul class="song-menu"></ul></div>`;
            
            const songIndex = playlist.findIndex(p => p.songData.id === songData.id);
            card.querySelector('.song-cover').onclick = () => playSongByIndex(songIndex);
            
            const titleEl = card.querySelector('.song-title');
            titleEl.onclick = () => copyToClipboard(songData.id, titleEl);

            const menu = card.querySelector('.song-menu');
            const menuTrigger = card.querySelector('.menu-trigger');
            menuTrigger.onclick = (e) => { e.stopPropagation(); menu.classList.toggle('active'); };
            
            const menuItems = [
                { icon: 'fa-download', text: '–°–∫–∞—á–∞—Ç—å', action: (e) => downloadSong(e, downloadUrl, filename) },
                { icon: 'fa-file-alt', text: '–¢–µ–∫—Å—Ç', action: () => showLyrics(songData.prompt) },
                { icon: 'fa-heart', text: '–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ', action: () => console.log('Favorite clicked') },
                { icon: 'fa-trash', text: '–£–¥–∞–ª–∏—Ç—å', action: () => deleteSong(songData.id, card), className: 'delete' }
            ];

            menuItems.forEach(item => {
                const li = document.createElement('li');
                li.className = 'menu-item ' + (item.className || '');
                li.innerHTML = `<i class="fas ${item.icon}"></i> ${item.text}`;
                li.onclick = item.action;
                menu.appendChild(li);
            });

            songListContainer.appendChild(card);

            setTimeout(() => {
                const styleContent = card.querySelector('.song-style-content');
                if (styleContent && styleContent.scrollHeight > styleContent.clientHeight) {
                    styleContent.classList.add('collapsed'); const toggleBtn = document.createElement('button');
                    toggleBtn.className = 'toggle-description-btn'; toggleBtn.textContent = '[ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å ]';
                    toggleBtn.onclick = () => { const isCollapsed = styleContent.classList.toggle('collapsed'); toggleBtn.textContent = isCollapsed ? '[ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å ]' : '[ —Å–≤–µ—Ä–Ω—É—Ç—å ]'; };
                    styleContent.parentElement.appendChild(toggleBtn);
                }
            }, 10);
        }

        async function startPolling(taskId) {
            if (pollingInterval) clearInterval(pollingInterval); createPlaceholderCard(taskId);
            updateStatus(`‚è≥ –ó–∞–¥–∞—á–∞ ${taskId.slice(0,8)}... –≤ –æ—á–µ—Ä–µ–¥–∏. –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É...`); let progress = 0;
            pollingInterval = setInterval(async () => {
                const progressBar = document.getElementById(`progress-${taskId}`);
                if (progress < 95) { progress += 5; if(progressBar) progressBar.style.width = `${progress}%`; }
                try {
                    const response = await fetch(`/api/task-status/${taskId}`); const result = await response.json();
                    document.getElementById("response-output").textContent = JSON.stringify(result, null, 2);
                    if (!response.ok) { handleTaskError(taskId, result.message || `–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`); return; }
                    if (!result.data) { handleTaskError(taskId, "–ü–æ–ª—É—á–µ–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç API (–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ 'data')."); return; }
                    const taskData = result.data; const statusLowerCase = taskData.status.toLowerCase();
                    const successStates = ["success", "completed"];
                    const pendingStates = ["pending", "running", "submitted", "queued", "text_success", "first_success"];
                    if (successStates.includes(statusLowerCase)) {
                        clearInterval(pollingInterval);
                        if(progressBar) progressBar.style.width = `100%`;
                        updateStatus("‚úÖ –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!", true);
                        const placeholder = document.getElementById(`placeholder-${taskId}`);
                        if(placeholder) placeholder.remove();
                        await loadSongsFromServer();
                        await handleApiCall("/api/chat/credit", { method: "GET" }, true);
                    } else if (pendingStates.includes(statusLowerCase)) {
                        updateStatus(`‚è≥ –°—Ç–∞—Ç—É—Å: ${taskData.status}. –°–ª–µ–¥—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 10 —Å–µ–∫...`);
                    } else { handleTaskError(taskId, taskData.errorMessage || `API –≤–µ—Ä–Ω—É–ª —Å—Ç–∞—Ç—É—Å —Å–±–æ—è: ${taskData.status}`); }
                } catch (error) { handleTaskError(taskId, "–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –∏–ª–∏ –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞."); }
            }, 10000);
        }
        
        async function loadSongsFromServer() {
            try {
                const response = await fetch('/api/songs');
                const songs = await response.json();
                songListContainer.innerHTML = '';
                playlist = songs;
                if (songs.length > 0) {
                    emptyListMessage.style.display = 'none';
                    songs.forEach(songInfo => addSongToList(songInfo));
                } else {
                    songListContainer.innerHTML = '<p id="empty-list-message">–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–∞—à–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Å–Ω–∏.</p>';
                }
            } catch(e) { console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Å–Ω–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞", e); }
        }

        function setupEventListeners() {
            selectButton.addEventListener("click",e=>{e.stopPropagation(),selectDropdown.classList.toggle("open")});
            selectDropdown.addEventListener("click",e=>{if(e.target.classList.contains("select-option")){modelValueInput.value=e.target.dataset.value;selectButton.textContent=e.target.textContent;document.querySelectorAll(".select-option").forEach(e=>e.classList.remove("selected"));e.target.classList.add("selected");updateCharacterLimits(modelValueInput.value)}});
            window.addEventListener("click",()=>{selectDropdown.classList.remove("open")});
            document.addEventListener('click', () => document.querySelectorAll('.song-menu.active').forEach(menu => menu.classList.remove('active')));
            customModeToggle.addEventListener("change", toggleGeneratorMode);
            instrumentalToggle.addEventListener("change", togglePromptVisibility);
            document.getElementById("generate-music-form").addEventListener("submit", function(e) {
                e.preventDefault(); if (!validateGenerateForm()) { updateStatus('üö´ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è.', false, true); return; }
                let payload = { model: modelValueInput.value, instrumental: instrumentalToggle.checked, customMode: customModeToggle.checked };
                if (payload.customMode) {
                    payload.title = titleInput.value; payload.style = styleTextarea.value; if (!payload.instrumental) payload.prompt = promptTextarea.value;
                    const negativeTags = document.getElementById("g-negativeTags").value; if(negativeTags) payload.negativeTags = negativeTags;
                    const vocalGender = document.getElementById("g-vocalGender").value; if (vocalGender) payload.vocalGender = vocalGender;
                } else { if (!payload.instrumental) payload.prompt = descriptionInput.value; }
                handleApiCall("/api/generate", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) }, false, true);
            });
        }

        // Initialize App State
        toggleGeneratorMode();
        updateCharacterLimits(modelValueInput.value);
        handleApiCall("/api/chat/credit", { method: "GET" }, true);
        loadSongsFromServer();
        setupEventListeners();
    }

    // --- –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ---
    document.addEventListener("DOMContentLoaded", () => {
        if (sessionStorage.getItem('is-authenticated') === 'true') {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
            initializeApp();
        }
    });

    // Helper functions that don't depend on initialized elements can stay outside
    function updateCharCounter(e,t){const o=document.getElementById(t);o&&(o.textContent=`${e.value.length} / ${e.maxLength}`)}
    function openTab(event, tabName) {
        if (currentTabName === tabName) return; const currentActiveTab = document.getElementById(currentTabName);
        const newTab = document.getElementById(tabName);
        document.querySelectorAll(".tab-button").forEach(btn => btn.classList.remove("active"));
        event.currentTarget.classList.add("active");
        if (currentActiveTab) {
            currentActiveTab.classList.add('exiting');
            currentActiveTab.addEventListener('animationend', () => {
                currentActiveTab.classList.remove('active', 'exiting'); currentActiveTab.style.display = 'none';
                newTab.style.display = 'block'; newTab.classList.add('active');
                currentTabName = tabName;
            }, { once: true });
        }
        if (tabName === 'logs') document.getElementById('logs-notification-dot').style.display = 'none';
    }
    async function handleApiCall(endpoint, options, isCreditCheck = false, isGeneration = false) {
        const responseOutput = document.getElementById("response-output");
        if(!isCreditCheck) { document.getElementById("status-container").innerHTML = '<p class="status-message">–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á–∏...</p>'; responseOutput.textContent = "–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å..."; }
        if (pollingInterval && !isCreditCheck) clearInterval(pollingInterval);
        try {
            const response = await fetch(endpoint, options); const result = await response.json();
            if (response.ok) {
                if(!isCreditCheck) responseOutput.textContent = JSON.stringify(result, null, 2);
                if (isCreditCheck && result.data !== undefined) { document.getElementById("credits-value").textContent = result.data; document.getElementById("credits-container").style.display = "inline-flex"; }
                if (isGeneration && result.data && result.data.taskId) { startPolling(result.data.taskId); } 
                else if (isGeneration) { updateStatus(`üö´ –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ${result.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å taskId.'}`, false, true); }
            } else {
                if(!isCreditCheck) responseOutput.textContent = `üö´ –û—à–∏–±–∫–∞ ${response.status}:\n\n${JSON.stringify(result, null, 2)}`;
                updateStatus(`üö´ –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: ${result.message || '–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É.'}`, false, true);
            }
        } catch (error) {
            if(!isCreditCheck) responseOutput.textContent = "üí• –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –∏–ª–∏ –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:\n\n" + error.message;
            updateStatus(`üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, false, true);
        }
    }
    function validateGenerateForm() {
        const titleInput = document.getElementById('g-title'), styleInput = document.getElementById('g-style'), promptInput = document.getElementById('g-prompt'), descriptionInput = document.getElementById('g-song-description');
        [titleInput, styleInput, promptInput, descriptionInput].forEach(el => el.classList.remove('input-error'));
        const isCustom = document.getElementById("g-customMode").checked, isInstrumental = document.getElementById("g-instrumental").checked; let allValid = true;
        if (isCustom) {
            if (titleInput.value.trim() === '') { titleInput.classList.add('input-error'); allValid = false; }
            if (styleInput.value.trim() === '') { styleInput.classList.add('input-error'); allValid = false; }
            if (!isInstrumental && promptInput.value.trim() === '') { promptInput.classList.add('input-error'); allValid = false; }
        } else { if (!isInstrumental && descriptionInput.value.trim() === '') { descriptionInput.classList.add('input-error'); allValid = false; } }
        return allValid;
    }
</script>

</body>
</html>